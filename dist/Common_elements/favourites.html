<script src="https://code.jquery.com/jquery-1.11.1.min.js"></script>
<script src="https://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.js"></script>
<script>
    var textData = localStorage.getItem("favList");
    var data = JSON.parse(textData);
   $(document).ready(function () {
    for (var i = 0; i < data.length; i++) {
      var id = "poi_" + i;
      var divs = document.createElement('div');
      divs.id = id;
      divs.className = "sort-style";
      $('#userContent').append(divs);
      $('#' + id).load('https://pet-temp-host.web.app/Common_elements/poi.html', function() {
        $('.sort-style').enhanceWithin();
      });
    }


   
  });

</script>

<div  class="background-container">
     <!--Search text box for map-->
  <div style="width: 320px;margin-left: 25px;margin-top: 20px;">
    <input class="controls" type="text" placeholder="Search for favourites" style="height: 40px;"/>
  </div>
  <hr>
  <p style="text-align: center;">Select your favourite caretakers and click on the email button to email.</p>
  <div style="text-align: center;
  font-size: 12px;">
      <button id="delete-fav-btn" style="display: inline;
      height: 45px;
      width: 150px;
      background-color: #FF2548;">DELETE</button>
      <button style="width: 200px;
      display: inline;
      height: 45px;
      position: relative;
      top: 2px;"><img src="../images/email fav.png" alt="" style="margin-right: 5px;
    margin-top: 3px;">EMAIL SELECTED</button>
  </div>

    <script>
        $(document).ready(function() {
            function loadUserData() {
                console.log(data);

                for (var i = 0; i < data.length; i++) {
                var id = "poi_"+i;
                $('#'+id+' .poi-style').find('p.poi_text').html(data[i]._nameUser);
                $('#'+id+' .poi-style').find('p.poi_address').html(data[i]._useraddress);
                $('#'+id+' .poi-style').find('img.poi-image').attr("src", data[i]._userpicture);
                $('#'+id+' .poi-style .poi-rating').find('p.poi-rating-para').html(data[i]._userRating);
                $('#'+id+' .poi-style .price_array').find('p.poi-service').html(data[i]._userservice);
                $('#'+id+' .poi-style .price_array').find('p.price_text').html(data[i]._price);
                $('#'+id+' .poi-style .poi-animal').find('img.animal').attr("src", data[i].animalImagePath);
                $('#'+id+' .poi-style .price_array .happy-pow').find('p.gammification_progress_text').html(data[i]._userpoints);
                $('#'+id).append('<input type="checkbox" name="myCheckbox" class="myCheckbox"/>');
                }

       
        }

        setTimeout(loadUserData, 500);

        $('.myCheckbox').each(function(){
          $(this).hide();
        });

        $('.myCheckbox').on('click',function(){
          $(this).addClass('checked').prev().prop('checked',$(this).is('.checked'))
        });

        var favList = [];
        var obj = null
        var namesList = [];
        $('#delete-fav-btn').on('click',function() {
            console.log("test");
            $("input:checkbox[name=myCheckbox]:checked").each(function(){
                namesList.push($(this).parent("div").find('p.poi_text').text());
                for (var i = 0; i < data.length; i++) {
                    if(data[i]._nameUser === $(this).parent("div").find('p.poi_text').text()){
                        favList = JSON.parse(localStorage.getItem("favList") || '[]');
                        obj = data[i];
                        favList = favList.filter(function( obj ) {
                            return obj._nameUser !== data[i]._nameUser;
                        });
                        localStorage.setItem("favList", JSON.stringify(favList));
                    }
                }
                        
            });
            
            $('#content').load('https://pet-temp-host.web.app/Common_elements/favourites.html');
            //var header_text = e.target.name;
            //$('#headerText').html(header_text);

        });

        function removeAllElements(array, elem) {
            var index = array.indexOf(elem);
            while (index > -1) {
                array.splice(index, 1);
                index = array.indexOf(elem);
                }
        }
        
    });
    </script>
    <div id="userContent">

    </div>
</div>
